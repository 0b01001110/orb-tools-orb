description: |
  Automatically shellcheck the run statements within your jobs and commands.

executor: cli/default

parameters:
  source-dir:
    description: Path containing the orb source files.
    type: string
    default: "./src"
  exclude:
    description: >
      Enter a comma-separated list, with no spaces, of errors to ignore. Example: "SC1009,SC1073"
    type: string
    default: ""

steps:
  - checkout
  - run:
      name: Install shellcheck
      command: |
        if [[ $EUID == 0 ]]; then export SUDO=""; else export SUDO="sudo"; fi
        $SUDO apt-get install shellcheck
  - run:
      name: Install YQ
      command: <<include(scripts/install-yq.sh)>>
  - run:
      name: ShellCheck
      environment:
        SOURCE_DIR: "<<parameters.source-dir>>"
        EXCLUDED_ERRORS: "<<#parameters.exclude>>,<<parameters.exclude>><</parameters.exclude>>"
      command: <<include(scripts/shellcheck.sh)>>
